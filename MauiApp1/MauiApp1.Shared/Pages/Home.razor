@page "/"
@using MauiApp1.Shared.Services
@inject IFormFactor FormFactor

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

<h2>Welcome to Blazor!</h2>

<!-- Master list -->
<table class="table">
    <thead>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Select</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var drucker in DruckerListe)
        {
            <tr class="@(SelectedDrucker?.Id == drucker.Id ? "table-primary" : "")">
                <td>@drucker.Id</td>
                <td>@drucker.Name</td>
                <td>
                    <button class="btn btn-sm btn-link"
                            @onclick="() => SelectDrucker(drucker)">
                        Select
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>

<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link @(activeTab=="calendar" ? "active" : "")"
           @onclick="@(() => activeTab = "checklist")">Calendar</a>
    </li>
    <li class="nav-item">
        <a class="nav-link @(activeTab=="checklist" ? "active" : "")"
           @onclick="@(() => activeTab="checklist")">Checklist</a>
    </li>
    <li class="nav-item">
        <a class="nav-link @(activeTab=="auftraege" ? "active" : "")"
           @onclick="@(() => activeTab="auftraege")">Aufträge</a>
    </li>
</ul>

<div class="tab-content">
    @if (activeTab == "calendar")
    {
        <div class="tab-pane active">
            <!-- Kalender-Komponente -->
            <CalendarComponent />
        </div>
    }
    else if (activeTab == "checklist")
    {
        <div class="tab-pane active">
            @foreach (var item in CheckListe)
            {
                <div>
                    <input type="checkbox" @bind="item.IsChecked" />
                    @item.Text
                </div>
            }
        </div>
    }
    else if (activeTab == "auftraege")
    {
        <div class="tab-pane active">
            <table class="table">
                <thead>
                    <tr>
                        <th>
                            <button class="btn btn-link p-0" @onclick="() => SortBy(nameof(Auftrag.Id))">
                                Id @(SortColumn == "Id" ? (SortAscending ? "▲" : "▼") : "")
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link p-0" @onclick="() => SortBy(nameof(Auftrag.DruckerId))">
                                DruckerId @(SortColumn == "DruckerId" ? (SortAscending ? "▲" : "▼") : "")
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link p-0" @onclick="() => SortBy(nameof(Auftrag.ArtikelId))">
                                ArtikelId @(SortColumn == "ArtikelId" ? (SortAscending ? "▲" : "▼") : "")
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link p-0" @onclick="() => SortBy(nameof(Auftrag.Status))">
                                Status @(SortColumn == "Status" ? (SortAscending ? "▲" : "▼") : "")
                            </button>
                        </th>
                    </tr>
                </thead>
                @foreach (var auftrag in PagedAuftraege)
                {
                    <tr>
                        <td>@auftrag.Id</td>
                        <td>@auftrag.DruckerId</td>
                        <td>@auftrag.ArtikelId</td>
                        <td>@auftrag.Status</td>
                    </tr>
                }
            </table>
            <!-- Pagination Controls -->
            <nav>
                <ul class="pagination">
                    <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                        <button class="page-link" @onclick="PrevPage">Previous</button>
                        
                    </li>
                    @for (int i = 1; i <= TotalPages; i++)
                    {
                        var pageIndex = i;   // lokale Kopie
                                             <li class="page-item @(CurrentPage == pageIndex ? "active" : "")">
                                                 <button class="page-link" @onclick="@(() => GoToPage(pageIndex))">@pageIndex</button>
                                             </li>
                    }
                    <li class="page-item @(CurrentPage == TotalPages ? "disabled" : "")">
                        
                        <button class="page-link" @onclick="NextPage">Next</button>
                    </li>
                </ul>
            </nav>
        </div>
    }
</div>


Welcome to your new app running on <em>@factor</em> using <em>@platform</em>.

@code {
    private string factor => FormFactor.GetFormFactor();
    private string platform => FormFactor.GetPlatform();
}

@code {
    List<Drucker> DruckerListe = AuftragService.GetAllDrucker();
    Drucker? SelectedDrucker;
    List<Auftrag> Auftraege = new();
    string activeTab = "calendar";

    void SelectDrucker(Drucker drucker)
    {
        SelectedDrucker = drucker;
        LoadAuftraege(drucker.Id);
    }

    void LoadAuftraege(int druckerId)
    {
        // EF Core / Service call
        Auftraege = AuftragService.GetByDrucker(druckerId);
    }
    public class CheckItem
    {
        public string Text { get; set; } = "";
        public bool IsChecked { get; set; }
    }

    List<CheckItem> CheckListe = new()
    {
        new CheckItem { Text = "test", IsChecked = false },
        new CheckItem { Text = "noch eins", IsChecked = true },
        new CheckItem { Text = "drittes", IsChecked = false }
    };
}


@code {
    /*pagination*/
    int PageSize = 10;
    int CurrentPage = 1;

    IEnumerable<Auftrag> PagedAuftraege =>
        GetSortedAuftraege().Skip((CurrentPage - 1) * PageSize).Take(PageSize);

    int TotalPages => (int)Math.Ceiling((double)Auftraege.Count / PageSize);

    void PrevPage()
    {
        if (CurrentPage > 1)
            CurrentPage--;
    }

    void NextPage()
    {
        if (CurrentPage < TotalPages)
            CurrentPage++;
    }

    void GoToPage(int page)
    {
        CurrentPage = page;
    }


    /*sorting*/
    IEnumerable<Auftrag> GetSortedAuftraege()
    {
        return SortColumn switch
        {
            "Id" => SortAscending ? Auftraege.OrderBy(a => a.Id) : Auftraege.OrderByDescending(a => a.Id),
            "DruckerId" => SortAscending ? Auftraege.OrderBy(a => a.DruckerId) : Auftraege.OrderByDescending(a => a.DruckerId),
            "ArtikelId" => SortAscending ? Auftraege.OrderBy(a => a.ArtikelId) : Auftraege.OrderByDescending(a => a.ArtikelId),
            "Status" => SortAscending ? Auftraege.OrderBy(a => a.Status) : Auftraege.OrderByDescending(a => a.Status),
            _ => Auftraege
        };
    }


    void SortBy(string column)
    {
        if (SortColumn == column)
            SortAscending = !SortAscending; // toggle direction
        else
        {
            SortColumn = column;
            SortAscending = true;
        }
        CurrentPage = 1; // reset to first page
    }

    string SortColumn = "Id";
    bool SortAscending = true;
}

